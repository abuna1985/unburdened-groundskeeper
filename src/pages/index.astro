---
/**
 * - GOAL: Dual-purpose dashboard for logging work and viewing history. 
 * - LAYOUT: Stacks on phones; splits into a side-by-side view on laptops.
 * - STABILITY: Sticky form ensures you don't lose your place while scrolling history.
 * - SPEED: Pulsing placeholders eliminate perceived load lag.
*/
import AppLayout from '../layouts/AppLayout.astro';
import { NewJobForm } from '../components/features/NewJobForm';
import { JobList } from '../components/features/JobList';
---

<AppLayout title="Groundskeeper">
  <header class="border-b-2 border-slate-200 pb-4 mb-8">
    <h1 class="text-2xl font-black uppercase tracking-[0.3em] text-ledger-action leading-none">Groundskeeper</h1>
  </header>

  <div class="lg:grid lg:grid-cols-12 lg:gap-12">

    {/* COLUMN 1: The Input Area (Pinned to top on desktop) */}
    <section aria-label="Job Entry Form" class="lg:col-span-5 lg:sticky lg:top-8 space-y-6">
      <h2 class="sr-only">Add New Job</h2>
      <NewJobForm client:load />
    </section>

    {/* COLUMN 2: The Data Feed */}
    <section aria-label="Active Jobs Feed" class="lg:col-span-7 relative mt-12 lg:mt-0">
      <h2 class="sr-only">Active Jobs List</h2>

      {/* The pulsing placeholder that disappears once data is ready */}
      <div id="loading-frame" class="space-y-6 pt-6">
        <div class="h-4 w-32 bg-slate-200 animate-pulse rounded-full"></div>
        <div class="space-y-4">
          {[1, 2, 3].map((i) => (
            <div key={i} class="h-32 w-full bg-white border border-slate-200 animate-pulse rounded-xl opacity-50"></div>
          ))}
        </div>
      </div>

      <JobList client:only="react" />
    </section> 
  </div>
</AppLayout>

<script>
  /**
   * INTENT: Remove the skeleton once the database is hydrated.
   * WHY: Prevents the user from seeing two lists at once.
   */
  import { $isHydrated } from '../stores/jobs';
  $isHydrated.subscribe(ready => {
    if (ready) document.getElementById('loading-frame')?.remove();
  });
</script>
